from flask import Flask, request
import telegram
import os

app = Flask(__name__)

TELEGRAM_TOKEN = os.environ.get("TELEGRAM_TOKEN")
CHAT_ID = os.environ.get("TELEGRAM_CHAT_ID")

bot = telegram.Bot(token=TELEGRAM_TOKEN)

@app.route('/receive_signal', methods=['POST'])
def receive_signal():
    data = request.json
    signal_text = data.get("message", "🚫 لا توجد رسالة مستلمة.")

    if "buy" in signal_text.lower():
        reply = f"📈 توصية شراء:\n{signal_text}"
    elif "sell" in signal_text.lower():
        reply = f"📉 توصية بيع:\n{signal_text}"
    else:
        reply = f"🔍 إشارة تحتاج مراجعة:\n{signal_text}"

    bot.send_message(chat_id=CHAT_ID, text=reply)
    return 'OK'